<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anomalize Quick Start Guide • anomalize</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Anomalize Quick Start Guide">
<meta property="og:description" content="anomalize">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-76139189-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76139189-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">anomalize</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/anomalize_quick_start_guide.html">Anomalize Quick Start Guide</a>
    </li>
    <li>
      <a href="../articles/anomalize_methods.html">Anomalize Methods</a>
    </li>
    <li>
      <a href="../articles/forecasting_with_cleaned_anomalies.html">Reduce Forecast Error by Cleaning Anomalies</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/business-science/anomalize">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="anomalize_quick_start_guide_files/header-attrs-2.4/header-attrs.js"></script><script src="anomalize_quick_start_guide_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Anomalize Quick Start Guide</h1>
                        <h4 class="author">Business Science</h4>
            
            <h4 class="date">2020-10-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/business-science/anomalize/blob/master/vignettes/anomalize_quick_start_guide.Rmd"><code>vignettes/anomalize_quick_start_guide.Rmd</code></a></small>
      <div class="hidden name"><code>anomalize_quick_start_guide.Rmd</code></div>

    </div>

    
    
<p>The <code>anomalize</code> package is a feature rich package for performing anomaly detection. It’s geared towards time series analysis, which is one of the biggest needs for understanding when anomalies occur. We have a quick start section called “5-Minutes to Anomalize” for those looking to jump right in. We also have a detailed section on parameter adjustment for those looking to understand what nobs they can turn. Finally, for those really looking to get under the hood, we have another vignette called “Anomalize Methods” that gets into a deep discussion on STL, Twitter, IQR and GESD methods that are used to power <code>anomalize</code>.</p>
<div id="anomalize-intro-on-youtube" class="section level2">
<h2 class="hasAnchor">
<a href="#anomalize-intro-on-youtube" class="anchor"></a>Anomalize Intro on YouTube</h2>
<p>As a first step, you may wish to watch our <code>anomalize</code> introduction video on YouTube.</p>
<p><a href="https://www.youtube.com/watch?v=Gk_HwjhlQJs" target="_blank"><img src="http://img.youtube.com/vi/Gk_HwjhlQJs/0.jpg" alt="Anomalize" width="100%" height="350"></a></p>
<p>Check out our entire <a href="https://www.youtube.com/watch?v=Gk_HwjhlQJs&amp;list=PLo32uKohmrXsYNhpdwr15W143rX6uMAze">Software Intro Series</a> on YouTube!</p>
</div>
<div id="minutes-to-anomalize" class="section level2">
<h2 class="hasAnchor">
<a href="#minutes-to-anomalize" class="anchor"></a>5-Minutes To Anomalize</h2>
<p>Load libraries.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/tibbletime">tibbletime</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/anomalize">anomalize</a></span><span class="op">)</span></pre></div>
<p>Get some data. We’ll use the <code>tidyverse_cran_downloads</code> data set that comes with <code>anomalize</code>. A few points:</p>
<ul>
<li><p>It’s a <code>tibbletime</code> object (class <code>tbl_time</code>), which is the object structure that <code>anomalize</code> works with because it’s time aware! Tibbles (class <code>tbl_df</code>) will automatically be converted.</p></li>
<li><p>It contains daily download counts on 15 “tidy” packages spanning 2017-01-01 to 2018-03-01. The 15 packages are already grouped for your convenience.</p></li>
<li><p>It’s all setup and ready to analyze with <code>anomalize</code>!</p></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="va">tidyverse_cran_downloads</span>
<span class="co">#&gt; # A time tibble: 6,375 x 3</span>
<span class="co">#&gt; # Index:  date</span>
<span class="co">#&gt; # Groups: package [15]</span>
<span class="co">#&gt;    date       count package</span>
<span class="co">#&gt;    &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;  </span>
<span class="co">#&gt;  1 2017-01-01   873 tidyr  </span>
<span class="co">#&gt;  2 2017-01-02  1840 tidyr  </span>
<span class="co">#&gt;  3 2017-01-03  2495 tidyr  </span>
<span class="co">#&gt;  4 2017-01-04  2906 tidyr  </span>
<span class="co">#&gt;  5 2017-01-05  2847 tidyr  </span>
<span class="co">#&gt;  6 2017-01-06  2756 tidyr  </span>
<span class="co">#&gt;  7 2017-01-07  1439 tidyr  </span>
<span class="co">#&gt;  8 2017-01-08  1556 tidyr  </span>
<span class="co">#&gt;  9 2017-01-09  3678 tidyr  </span>
<span class="co">#&gt; 10 2017-01-10  7086 tidyr  </span>
<span class="co">#&gt; # … with 6,365 more rows</span></pre></div>
<p>We can use the general workflow for anomaly detection, which involves three main functions:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/time_decompose.html">time_decompose()</a></code>: Separates the time series into seasonal, trend, and remainder components</li>
<li>
<code><a href="../reference/anomalize.html">anomalize()</a></code>: Applies anomaly detection methods to the remainder component.</li>
<li>
<code><a href="../reference/time_recompose.html">time_recompose()</a></code>: Calculates limits that separate the “normal” data from the anomalies!</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="va">tidyverse_cran_downloads_anomalized</span> <span class="op">&lt;-</span> <span class="va">tidyverse_cran_downloads</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/time_decompose.html">time_decompose</a></span><span class="op">(</span><span class="va">count</span>, merge <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/anomalize.html">anomalize</a></span><span class="op">(</span><span class="va">remainder</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/time_recompose.html">time_recompose</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Registered S3 method overwritten by 'quantmod':</span>
<span class="co">#&gt;   method            from</span>
<span class="co">#&gt;   as.zoo.data.frame zoo</span>

<span class="va">tidyverse_cran_downloads_anomalized</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Rows: 6,375</span>
<span class="co">#&gt; Columns: 12</span>
<span class="co">#&gt; Groups: package [15]</span>
<span class="co">#&gt; $ package       &lt;chr&gt; "broom", "broom", "broom", "broom", "broom", "broom", "…</span>
<span class="co">#&gt; $ date          &lt;date&gt; 2017-01-01, 2017-01-02, 2017-01-03, 2017-01-04, 2017-0…</span>
<span class="co">#&gt; $ count         &lt;dbl&gt; 1053, 1481, 1851, 1947, 1927, 1948, 1542, 1479, 2057, 2…</span>
<span class="co">#&gt; $ observed      &lt;dbl&gt; 1.053000e+03, 1.481000e+03, 1.851000e+03, 1.947000e+03,…</span>
<span class="co">#&gt; $ season        &lt;dbl&gt; -1006.9759, 339.6028, 562.5794, 526.0532, 430.1275, 136…</span>
<span class="co">#&gt; $ trend         &lt;dbl&gt; 1708.465, 1730.742, 1753.018, 1775.294, 1797.571, 1819.…</span>
<span class="co">#&gt; $ remainder     &lt;dbl&gt; 351.510801, -589.344328, -464.597345, -354.347509, -300…</span>
<span class="co">#&gt; $ remainder_l1  &lt;dbl&gt; -1724.778, -1724.778, -1724.778, -1724.778, -1724.778, …</span>
<span class="co">#&gt; $ remainder_l2  &lt;dbl&gt; 1704.371, 1704.371, 1704.371, 1704.371, 1704.371, 1704.…</span>
<span class="co">#&gt; $ anomaly       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No", "…</span>
<span class="co">#&gt; $ recomposed_l1 &lt;dbl&gt; -1023.2887, 345.5664, 590.8195, 576.5696, 502.9204, 231…</span>
<span class="co">#&gt; $ recomposed_l2 &lt;dbl&gt; 2405.860, 3774.715, 4019.968, 4005.718, 3932.069, 3660.…</span></pre></div>
<p>Let’s explain what happened:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/time_decompose.html">time_decompose(count, merge = TRUE)</a></code>: This performs a time series decomposition on the “count” column using seasonal decomposition. It created four columns:
<ul>
<li>“observed”: The observed values (actuals)</li>
<li>“season”: The seasonal or cyclic trend. The default for daily data is a weekly seasonality.</li>
<li>“trend”: This is the long term trend. The default is a Loess smoother using spans of 3-months for daily data.</li>
<li>“remainder”: This is what we want to analyze for outliers. It is simply the observed minus both the season and trend.</li>
<li>Setting <code>merge = TRUE</code> keeps the original data with the newly created columns.</li>
</ul>
</li>
<li>
<code><a href="../reference/anomalize.html">anomalize(remainder)</a></code>: This performs anomaly detection on the remainder column. It creates three new columns:
<ul>
<li>“remainder_l1”: The lower limit of the remainder</li>
<li>“remainder_l2”: The upper limit of the remainder</li>
<li>“anomaly”: Yes/No telling us whether or not the observation is an anomaly</li>
</ul>
</li>
<li>
<code><a href="../reference/time_recompose.html">time_recompose()</a></code>: This recomposes the season, trend and remainder_l1 and remainder_l2 columns into new limits that bound the observed values. The two new columns created are:
<ul>
<li>“recomposed_l1”: The lower bound of outliers around the observed value</li>
<li>“recomposed_l2”: The upper bound of outliers around the observed value</li>
</ul>
</li>
</ol>
<p>We can then visualize the anomalies using the <code><a href="../reference/plot_anomalies.html">plot_anomalies()</a></code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="va">tidyverse_cran_downloads_anomalized</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/plot_anomalies.html">plot_anomalies</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">3</span>, alpha_dots <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></pre></div>
<p><img src="anomalize_quick_start_guide_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="parameter-adjustment" class="section level2">
<h2 class="hasAnchor">
<a href="#parameter-adjustment" class="anchor"></a>Parameter Adjustment</h2>
<p>Now that you have an overview of the package, you can begin to adjust the parameter settings. The first settings you may wish to explore are related to time series decomposition: trend and seasonality. The second are related to anomaly detection: alpha and max anoms.</p>
<div id="adjusting-decomposition-trend-and-seasonality" class="section level3">
<h3 class="hasAnchor">
<a href="#adjusting-decomposition-trend-and-seasonality" class="anchor"></a>Adjusting Decomposition Trend and Seasonality</h3>
<p>Adjusting the trend and seasonality are fundamental to time series analysis and specifically time series decomposition. With <code>anomalize</code>, it’s simple to make adjustments because everything is done with date or datetime information so you can intuitively select increments by time spans that make sense (e.g. “5 minutes” or “1 month”).</p>
<p>To get started, let’s isolate one of the time series packages: lubridate.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">lubridate_daily_downloads</span> <span class="op">&lt;-</span> <span class="va">tidyverse_cran_downloads</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">package</span> <span class="op">==</span> <span class="st">"lubridate"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">lubridate_daily_downloads</span>
<span class="co">#&gt; # A time tibble: 425 x 3</span>
<span class="co">#&gt; # Index: date</span>
<span class="co">#&gt;    date       count package  </span>
<span class="co">#&gt;    &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;    </span>
<span class="co">#&gt;  1 2017-01-01   643 lubridate</span>
<span class="co">#&gt;  2 2017-01-02  1350 lubridate</span>
<span class="co">#&gt;  3 2017-01-03  2940 lubridate</span>
<span class="co">#&gt;  4 2017-01-04  4269 lubridate</span>
<span class="co">#&gt;  5 2017-01-05  3724 lubridate</span>
<span class="co">#&gt;  6 2017-01-06  2326 lubridate</span>
<span class="co">#&gt;  7 2017-01-07  1107 lubridate</span>
<span class="co">#&gt;  8 2017-01-08  1058 lubridate</span>
<span class="co">#&gt;  9 2017-01-09  2494 lubridate</span>
<span class="co">#&gt; 10 2017-01-10  3237 lubridate</span>
<span class="co">#&gt; # … with 415 more rows</span></pre></div>
<p>Next, let’s perform anomaly detection.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">lubridate_daily_downloads_anomalized</span> <span class="op">&lt;-</span> <span class="va">lubridate_daily_downloads</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="../reference/time_decompose.html">time_decompose</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/anomalize.html">anomalize</a></span><span class="op">(</span><span class="va">remainder</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/time_recompose.html">time_recompose</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>

<span class="va">lubridate_daily_downloads_anomalized</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Rows: 425</span>
<span class="co">#&gt; Columns: 10</span>
<span class="co">#&gt; $ date          &lt;date&gt; 2017-01-01, 2017-01-02, 2017-01-03, 2017-01-04, 2017-0…</span>
<span class="co">#&gt; $ observed      &lt;dbl&gt; 6.430000e+02, 1.350000e+03, 2.940000e+03, 4.269000e+03,…</span>
<span class="co">#&gt; $ season        &lt;dbl&gt; -2077.6548, 517.9370, 1117.0490, 1219.5377, 865.1171, 3…</span>
<span class="co">#&gt; $ trend         &lt;dbl&gt; 2474.491, 2491.126, 2507.761, 2524.397, 2541.032, 2557.…</span>
<span class="co">#&gt; $ remainder     &lt;dbl&gt; 246.1636, -1659.0632, -684.8105, 525.0657, 317.8511, -5…</span>
<span class="co">#&gt; $ remainder_l1  &lt;dbl&gt; -3323.425, -3323.425, -3323.425, -3323.425, -3323.425, …</span>
<span class="co">#&gt; $ remainder_l2  &lt;dbl&gt; 3310.268, 3310.268, 3310.268, 3310.268, 3310.268, 3310.…</span>
<span class="co">#&gt; $ anomaly       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No", "…</span>
<span class="co">#&gt; $ recomposed_l1 &lt;dbl&gt; -2926.58907, -314.36218, 301.38509, 420.50889, 82.72349…</span>
<span class="co">#&gt; $ recomposed_l2 &lt;dbl&gt; 3707.105, 6319.331, 6935.079, 7054.202, 6716.417, 6223.…</span></pre></div>
<p>First, notice that a <code>frequency</code> and a <code>trend</code> were automatically selected for us. This is by design. The arguments <code>frequency = "auto"</code> and <code>trend = "auto"</code> are the defaults. We can visualize this decomposition using <code><a href="../reference/plot_anomaly_decomposition.html">plot_anomaly_decomposition()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">lubridate_daily_downloads_anomalized</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/plot_anomaly_decomposition.html">plot_anomaly_decomposition</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Freq/Trend = 'auto'"</span><span class="op">)</span>

<span class="va">p1</span></pre></div>
<p><img src="anomalize_quick_start_guide_files/figure-html/unnamed-chunk-7-1.png" width="480" style="display: block; margin: auto;"></p>
<p>When “auto” is used, a <code><a href="../reference/set_time_scale_template.html">get_time_scale_template()</a></code> is used to determine logical frequency and trend spans based on the scale of the data. You can uncover the logic:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="fu"><a href="../reference/set_time_scale_template.html">get_time_scale_template</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 8 x 3</span>
<span class="co">#&gt;   time_scale frequency trend   </span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;   </span>
<span class="co">#&gt; 1 second     1 hour    12 hours</span>
<span class="co">#&gt; 2 minute     1 day     14 days </span>
<span class="co">#&gt; 3 hour       1 day     1 month </span>
<span class="co">#&gt; 4 day        1 week    3 months</span>
<span class="co">#&gt; 5 week       1 quarter 1 year  </span>
<span class="co">#&gt; 6 month      1 year    5 years </span>
<span class="co">#&gt; 7 quarter    1 year    10 years</span>
<span class="co">#&gt; 8 year       5 years   30 years</span></pre></div>
<p>What this means is that if the scale is 1 day (meaning the difference between each data point is 1 day), then the frequency will be 7 days (or 1 week) and the trend will be around 90 days (or 3 months). This logic tends to work quite well for anomaly detection, but you may wish to adjust it. There are two ways:</p>
<ol style="list-style-type: decimal">
<li>Local parameter adjustment</li>
<li>Global parameter adjustment</li>
</ol>
<div id="local-parameter-adjustment" class="section level4">
<h4 class="hasAnchor">
<a href="#local-parameter-adjustment" class="anchor"></a>Local Parameter Adjustment</h4>
<p>Local parameter adjustment can be performed by tweaking the in-function parameters. Below we adjust <code>trend = "2 weeks"</code> which makes for a quite overfit trend.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="co"># Local adjustment via time_decompose</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">lubridate_daily_downloads</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/time_decompose.html">time_decompose</a></span><span class="op">(</span><span class="va">count</span>,
                   frequency <span class="op">=</span> <span class="st">"auto"</span>,
                   trend     <span class="op">=</span> <span class="st">"2 weeks"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/anomalize.html">anomalize</a></span><span class="op">(</span><span class="va">remainder</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/plot_anomaly_decomposition.html">plot_anomaly_decomposition</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Trend = 2 Weeks (Local)"</span><span class="op">)</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 14 days</span>

<span class="co"># Show plots</span>
<span class="va">p1</span>
<span class="va">p2</span></pre></div>
<p><img src="anomalize_quick_start_guide_files/figure-html/unnamed-chunk-9-1.png" width="700"><img src="anomalize_quick_start_guide_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
</div>
<div id="global-parameter-adjustement" class="section level4">
<h4 class="hasAnchor">
<a href="#global-parameter-adjustement" class="anchor"></a>Global Parameter Adjustement</h4>
<p>We can also adjust globally by using <code><a href="../reference/set_time_scale_template.html">set_time_scale_template()</a></code> to update the default template to one that we prefer. We’ll change the “3 month” trend to “2 weeks” for time scale = “day”. Use <code><a href="../reference/set_time_scale_template.html">time_scale_template()</a></code> to retrieve the time scale template that <code>anomalize</code> begins with, them <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> the trend field in the desired location, and use <code><a href="../reference/set_time_scale_template.html">set_time_scale_template()</a></code> to update the template in the global options. We can retrieve the updated template using <code><a href="../reference/set_time_scale_template.html">get_time_scale_template()</a></code> to verify the change has been executed properly.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="co"># Globally change time scale template options</span>
<span class="fu"><a href="../reference/set_time_scale_template.html">time_scale_template</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>trend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">time_scale</span> <span class="op">==</span> <span class="st">"day"</span>, <span class="st">"2 weeks"</span>, <span class="va">trend</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/set_time_scale_template.html">set_time_scale_template</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="../reference/set_time_scale_template.html">get_time_scale_template</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 8 x 3</span>
<span class="co">#&gt;   time_scale frequency trend   </span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;   </span>
<span class="co">#&gt; 1 second     1 hour    12 hours</span>
<span class="co">#&gt; 2 minute     1 day     14 days </span>
<span class="co">#&gt; 3 hour       1 day     1 month </span>
<span class="co">#&gt; 4 day        1 week    2 weeks </span>
<span class="co">#&gt; 5 week       1 quarter 1 year  </span>
<span class="co">#&gt; 6 month      1 year    5 years </span>
<span class="co">#&gt; 7 quarter    1 year    10 years</span>
<span class="co">#&gt; 8 year       5 years   30 years</span></pre></div>
<p>Finally we can re-run the <code><a href="../reference/time_decompose.html">time_decompose()</a></code> with defaults, and we can see that the trend is “2 weeks”.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">lubridate_daily_downloads</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/time_decompose.html">time_decompose</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/anomalize.html">anomalize</a></span><span class="op">(</span><span class="va">remainder</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/plot_anomaly_decomposition.html">plot_anomaly_decomposition</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Trend = 2 Weeks (Global)"</span><span class="op">)</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 14 days</span>

<span class="va">p3</span></pre></div>
<p><img src="anomalize_quick_start_guide_files/figure-html/unnamed-chunk-11-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Let’s reset the time scale template defaults back to the original defaults.</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="co"># Set time scale template to the original defaults</span>
<span class="fu"><a href="../reference/set_time_scale_template.html">time_scale_template</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/set_time_scale_template.html">set_time_scale_template</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Verify the change</span>
<span class="fu"><a href="../reference/set_time_scale_template.html">get_time_scale_template</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 8 x 3</span>
<span class="co">#&gt;   time_scale frequency trend   </span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;   </span>
<span class="co">#&gt; 1 second     1 hour    12 hours</span>
<span class="co">#&gt; 2 minute     1 day     14 days </span>
<span class="co">#&gt; 3 hour       1 day     1 month </span>
<span class="co">#&gt; 4 day        1 week    3 months</span>
<span class="co">#&gt; 5 week       1 quarter 1 year  </span>
<span class="co">#&gt; 6 month      1 year    5 years </span>
<span class="co">#&gt; 7 quarter    1 year    10 years</span>
<span class="co">#&gt; 8 year       5 years   30 years</span></pre></div>
</div>
</div>
<div id="adjusting-anomaly-detection-alpha-and-max-anoms" class="section level3">
<h3 class="hasAnchor">
<a href="#adjusting-anomaly-detection-alpha-and-max-anoms" class="anchor"></a>Adjusting Anomaly Detection Alpha and Max Anoms</h3>
<p>The <code>alpha</code> and <code>max_anoms</code> are the two parameters that control the <code><a href="../reference/anomalize.html">anomalize()</a></code> function. Here’s how they work.</p>
<div id="alpha" class="section level4">
<h4 class="hasAnchor">
<a href="#alpha" class="anchor"></a>Alpha</h4>
<p>We can adjust <code>alpha</code>, which is set to 0.05 by default. By default the bands just cover the outside of the range.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="va">p4</span> <span class="op">&lt;-</span> <span class="va">lubridate_daily_downloads</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/time_decompose.html">time_decompose</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/anomalize.html">anomalize</a></span><span class="op">(</span><span class="va">remainder</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, max_anoms <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/time_recompose.html">time_recompose</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/plot_anomalies.html">plot_anomalies</a></span><span class="op">(</span>time_recomposed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"alpha = 0.05"</span><span class="op">)</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>

<span class="va">p4</span></pre></div>
<p><img src="anomalize_quick_start_guide_files/figure-html/unnamed-chunk-13-1.png" width="480" style="display: block; margin: auto;"></p>
<p>We can decrease <code>alpha</code>, which increases the bands making it more difficult to be an outlier. See that the bands doubled in size.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="va">p5</span> <span class="op">&lt;-</span> <span class="va">lubridate_daily_downloads</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/time_decompose.html">time_decompose</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/anomalize.html">anomalize</a></span><span class="op">(</span><span class="va">remainder</span>, alpha <span class="op">=</span> <span class="fl">0.025</span>, max_anoms <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/time_recompose.html">time_recompose</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/plot_anomalies.html">plot_anomalies</a></span><span class="op">(</span>time_recomposed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"alpha = 0.025"</span><span class="op">)</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>

<span class="va">p4</span> 
<span class="va">p5</span></pre></div>
<p><img src="anomalize_quick_start_guide_files/figure-html/unnamed-chunk-14-1.png" width="700"><img src="anomalize_quick_start_guide_files/figure-html/unnamed-chunk-14-2.png" width="700"></p>
</div>
<div id="max-anoms" class="section level4">
<h4 class="hasAnchor">
<a href="#max-anoms" class="anchor"></a>Max Anoms</h4>
<p>The <code>max_anoms</code> parameter is used to control the maximum percentage of data that can be an anomaly. This is useful in cases where <code>alpha</code> is too difficult to tune, and you really want to focus on the most aggregious anomalies.</p>
<p>Let’s adjust <code>alpha = 0.3</code> so pretty much anything is an outlier. Now let’s try a comparison between <code>max_anoms = 0.2</code> (20% anomalies allowed) and <code>max_anoms = 0.05</code> (5% anomalies allowed).</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="va">p6</span> <span class="op">&lt;-</span> <span class="va">lubridate_daily_downloads</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/time_decompose.html">time_decompose</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/anomalize.html">anomalize</a></span><span class="op">(</span><span class="va">remainder</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, max_anoms <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/time_recompose.html">time_recompose</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/plot_anomalies.html">plot_anomalies</a></span><span class="op">(</span>time_recomposed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"20% Anomalies"</span><span class="op">)</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>

<span class="va">p7</span> <span class="op">&lt;-</span> <span class="va">lubridate_daily_downloads</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/time_decompose.html">time_decompose</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/anomalize.html">anomalize</a></span><span class="op">(</span><span class="va">remainder</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, max_anoms <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/time_recompose.html">time_recompose</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/plot_anomalies.html">plot_anomalies</a></span><span class="op">(</span>time_recomposed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"5% Anomalies"</span><span class="op">)</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>

<span class="va">p6</span>
<span class="va">p7</span></pre></div>
<p><img src="anomalize_quick_start_guide_files/figure-html/unnamed-chunk-15-1.png" width="700"><img src="anomalize_quick_start_guide_files/figure-html/unnamed-chunk-15-2.png" width="700"></p>
<p>In reality, you’ll probably want to leave <code>alpha</code> in the range of 0.10 to 0.02, but it makes a nice illustration of how you can also use <code>max_anoms</code> to ensure only the most aggregious anomalies are identified.</p>
</div>
</div>
</div>
<div id="further-understanding-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#further-understanding-methods" class="anchor"></a>Further Understanding: Methods</h2>
<p>If you haven’t had your fill and want to dive into the methods that power anomalize, check out the vignette, “Anomalize Methods”.</p>
</div>
<div id="interested-in-learning-anomaly-detection" class="section level1">
<h1 class="hasAnchor">
<a href="#interested-in-learning-anomaly-detection" class="anchor"></a>Interested in Learning Anomaly Detection?</h1>
<p>Business Science offers two 1-hour courses on Anomaly Detection:</p>
<ul>
<li><p><a href="https://university.business-science.io/p/learning-labs-pro">Learning Lab 18</a> - Time Series Anomaly Detection with <code>anomalize</code></p></li>
<li><p><a href="https://university.business-science.io/p/learning-labs-pro">Learning Lab 17</a> - Anomaly Detection with <code>H2O</code> Machine Learning</p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matt Dancho, Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
