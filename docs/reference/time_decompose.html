<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Decompose a time series in preparation for anomaly detection — time_decompose • anomalize</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Decompose a time series in preparation for anomaly detection — time_decompose" />
<meta property="og:description" content="Decompose a time series in preparation for anomaly detection" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-76139189-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76139189-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">anomalize</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/anomalize_quick_start_guide.html">Anomalize Quick Start Guide</a>
    </li>
    <li>
      <a href="../articles/anomalize_methods.html">Anomalize Methods</a>
    </li>
    <li>
      <a href="../articles/forecasting_with_cleaned_anomalies.html">Reduce Forecast Error by Cleaning Anomalies</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/business-science/anomalize">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Decompose a time series in preparation for anomaly detection</h1>
    <small class="dont-index">Source: <a href='https://github.com/business-science/anomalize/blob/master/R/time_decompose.R'><code>R/time_decompose.R</code></a></small>
    <div class="hidden name"><code>time_decompose.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Decompose a time series in preparation for anomaly detection</p>
    </div>

    <pre class="usage"><span class='fu'>time_decompose</span><span class='op'>(</span>
  <span class='va'>data</span>,
  <span class='va'>target</span>,
  method <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"stl"</span>, <span class='st'>"twitter"</span><span class='op'>)</span>,
  frequency <span class='op'>=</span> <span class='st'>"auto"</span>,
  trend <span class='op'>=</span> <span class='st'>"auto"</span>,
  <span class='va'>...</span>,
  merge <span class='op'>=</span> <span class='cn'>FALSE</span>,
  message <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A <code>tibble</code> or <code>tbl_time</code> object.</p></td>
    </tr>
    <tr>
      <th>target</th>
      <td><p>A column to apply the function to</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>The time series decomposition method. One of <code>"stl"</code> or <code>"twitter"</code>.
The STL method uses seasonal decomposition (see <code><a href='decompose_methods.html'>decompose_stl()</a></code>).
The Twitter method uses <code>trend</code> to remove the trend (see <code><a href='decompose_methods.html'>decompose_twitter()</a></code>).</p></td>
    </tr>
    <tr>
      <th>frequency</th>
      <td><p>Controls the seasonal adjustment (removal of seasonality).
Input can be either "auto", a time-based definition (e.g. "2 weeks"),
or a numeric number of observations per frequency (e.g. 10).
Refer to <code><a href='time_frequency.html'>time_frequency()</a></code>.</p></td>
    </tr>
    <tr>
      <th>trend</th>
      <td><p>Controls the trend component
For stl, the trend controls the sensitivity of the lowess smoother, which is used to remove the remainder.
For twitter, the trend controls the period width of the median, which are used to remove the trend and center the remainder.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional parameters passed to the underlying method functions.</p></td>
    </tr>
    <tr>
      <th>merge</th>
      <td><p>A boolean. <code>FALSE</code> by default. If <code>TRUE</code>, will append results to the original data.</p></td>
    </tr>
    <tr>
      <th>message</th>
      <td><p>A boolean. If <code>TRUE</code>, will output information related to <code>tbl_time</code> conversions, frequencies,
and trend / median spans (if applicable).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns a <code>tbl_time</code> object.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>time_decompose()</code> function generates a time series decomposition on
<code>tbl_time</code> objects. The function is "tidy" in the sense that it works
on data frames. It is designed to work with time-based data, and as such
must have a column that contains date or datetime information. The function
also works with grouped data. The function implements several methods
of time series decomposition, each with benefits.</p>
<p><strong>STL</strong>:</p>
<p>The STL method (<code>method = "stl"</code>) implements time series decomposition using
the underlying <code><a href='decompose_methods.html'>decompose_stl()</a></code> function. If you are familiar with <code><a href='https://rdrr.io/r/stats/stl.html'>stats::stl()</a></code>,
the function is a "tidy" version that is designed to work with <code>tbl_time</code> objects.
The decomposition separates the "season" and "trend" components from
the "observed" values leaving the "remainder" for anomaly detection.
The user can control two parameters: <code>frequency</code> and <code>trend</code>.
The <code>frequency</code> parameter adjusts the "season" component that is removed
from the "observed" values. The <code>trend</code> parameter adjusts the
trend window (<code>t.window</code> parameter from <code><a href='https://rdrr.io/r/stats/stl.html'>stl()</a></code>) that is used.
The user may supply both <code>frequency</code>
and <code>trend</code> as time-based durations (e.g. "6 weeks") or numeric values
(e.g. 180) or "auto", which predetermines the frequency and/or trend
based on the scale of the time series.</p>
<p><strong>Twitter</strong>:</p>
<p>The Twitter method (<code>method = "twitter"</code>) implements time series decomposition using
the methodology from the Twitter <a href='https://github.com/twitter/AnomalyDetection'>AnomalyDetection</a> package.
The decomposition separates the "seasonal" component and then removes
the median data, which is a different approach than the STL method for removing
the trend. This approach works very well for low-growth + high seasonality data.
STL may be a better approach when trend is a large factor.
The user can control two parameters: <code>frequency</code> and <code>trend</code>.
The <code>frequency</code> parameter adjusts the "season" component that is removed
from the "observed" values. The <code>trend</code> parameter adjusts the
period width of the median spans that are used. The user may supply both <code>frequency</code>
and <code>trend</code> as time-based durations (e.g. "6 weeks") or numeric values
(e.g. 180) or "auto", which predetermines the frequency and/or median spans
based on the scale of the time series.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    
<ol>
<li><p>CLEVELAND, R. B., CLEVELAND, W. S., MCRAE, J. E., AND TERPENNING, I.
STL: A Seasonal-Trend Decomposition Procedure Based on Loess. Journal of Official Statistics, Vol. 6, No. 1 (1990), pp. 3-73.</p></li>
<li><p><a href='https://www.usenix.org/system/files/conference/hotcloud14/hotcloud14-vallis.pdf'>Owen S. Vallis, Jordan Hochenbaum and Arun Kejariwal (2014). A Novel Technique for Long-Term Anomaly Detection in the Cloud. Twitter Inc.</a></p></li>
<li><p><a href='https://github.com/twitter/AnomalyDetection'>Owen S. Vallis, Jordan Hochenbaum and Arun Kejariwal (2014). AnomalyDetection: Anomaly Detection Using Seasonal Hybrid Extreme Studentized Deviate Test. R package version 1.0.</a></p></li>
</ol>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Decomposition Methods (Powers <code>time_decompose</code>)</p><ul>
<li><p><code><a href='decompose_methods.html'>decompose_stl()</a></code></p></li>
<li><p><code><a href='decompose_methods.html'>decompose_twitter()</a></code></p></li>
</ul>

<p>Time Series Anomaly Detection Functions (anomaly detection workflow):</p><ul>
<li><p><code><a href='anomalize.html'>anomalize()</a></code></p></li>
<li><p><code><a href='time_recompose.html'>time_recompose()</a></code></p></li>
</ul>
</div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>tidyverse_cran_downloads</span><span class='op'>)</span>

<span class='co'># Basic Usage</span>
<span class='va'>tidyverse_cran_downloads</span> <span class='op'>%&gt;%</span>
    <span class='fu'>time_decompose</span><span class='op'>(</span><span class='va'>count</span>, method <span class='op'>=</span> <span class='st'>"stl"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; # A time tibble: 6,375 x 6
#&gt; <span style='color: #555555;'># Index:  date</span><span>
#&gt; </span><span style='color: #555555;'># Groups: package [15]</span><span>
#&gt;    package date       observed season trend remainder
#&gt;    </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #555555;font-style: italic;'>&lt;date&gt;</span><span>        </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'> 1</span><span> broom   2017-01-01    </span><span style='text-decoration: underline;'>1</span><span>053. -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>007.</span><span> </span><span style='text-decoration: underline;'>1</span><span>708.    352.  
#&gt; </span><span style='color: #555555;'> 2</span><span> broom   2017-01-02    </span><span style='text-decoration: underline;'>1</span><span>481    340. </span><span style='text-decoration: underline;'>1</span><span>731.   -</span><span style='color: #BB0000;'>589.</span><span>  
#&gt; </span><span style='color: #555555;'> 3</span><span> broom   2017-01-03    </span><span style='text-decoration: underline;'>1</span><span>851    563. </span><span style='text-decoration: underline;'>1</span><span>753.   -</span><span style='color: #BB0000;'>465.</span><span>  
#&gt; </span><span style='color: #555555;'> 4</span><span> broom   2017-01-04    </span><span style='text-decoration: underline;'>1</span><span>947    526. </span><span style='text-decoration: underline;'>1</span><span>775.   -</span><span style='color: #BB0000;'>354.</span><span>  
#&gt; </span><span style='color: #555555;'> 5</span><span> broom   2017-01-05    </span><span style='text-decoration: underline;'>1</span><span>927    430. </span><span style='text-decoration: underline;'>1</span><span>798.   -</span><span style='color: #BB0000;'>301.</span><span>  
#&gt; </span><span style='color: #555555;'> 6</span><span> broom   2017-01-06    </span><span style='text-decoration: underline;'>1</span><span>948    136. </span><span style='text-decoration: underline;'>1</span><span>820.     -</span><span style='color: #BB0000;'>8.11</span><span>
#&gt; </span><span style='color: #555555;'> 7</span><span> broom   2017-01-07    </span><span style='text-decoration: underline;'>1</span><span>542   -</span><span style='color: #BB0000;'>988.</span><span> </span><span style='text-decoration: underline;'>1</span><span>842.    688.  
#&gt; </span><span style='color: #555555;'> 8</span><span> broom   2017-01-08    </span><span style='text-decoration: underline;'>1</span><span>479. -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>007.</span><span> </span><span style='text-decoration: underline;'>1</span><span>864.    622.  
#&gt; </span><span style='color: #555555;'> 9</span><span> broom   2017-01-09    </span><span style='text-decoration: underline;'>2</span><span>057    340. </span><span style='text-decoration: underline;'>1</span><span>887.   -</span><span style='color: #BB0000;'>169.</span><span>  
#&gt; </span><span style='color: #555555;'>10</span><span> broom   2017-01-10    </span><span style='text-decoration: underline;'>2</span><span>278    563. </span><span style='text-decoration: underline;'>1</span><span>909.   -</span><span style='color: #BB0000;'>194.</span><span>  
#&gt; </span><span style='color: #555555;'># … with 6,365 more rows</span><span></div><div class='input'>
<span class='co'># twitter</span>
<span class='va'>tidyverse_cran_downloads</span> <span class='op'>%&gt;%</span>
    <span class='fu'>time_decompose</span><span class='op'>(</span><span class='va'>count</span>,
                   method       <span class='op'>=</span> <span class='st'>"twitter"</span>,
                   frequency    <span class='op'>=</span> <span class='st'>"1 week"</span>,
                   trend        <span class='op'>=</span> <span class='st'>"2 months"</span>,
                   merge        <span class='op'>=</span> <span class='cn'>TRUE</span>,
                   message      <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; # A time tibble: 6,375 x 7
#&gt; </span><span style='color: #555555;'># Index:  date</span><span>
#&gt; </span><span style='color: #555555;'># Groups: package [15]</span><span>
#&gt;    package date       count observed season median_spans remainder
#&gt;    </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #555555;font-style: italic;'>&lt;date&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>        </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'> 1</span><span> broom   2017-01-01  </span><span style='text-decoration: underline;'>1</span><span>053     </span><span style='text-decoration: underline;'>1</span><span>053 -</span><span style='color: #BB0000;'>871.</span><span>          </span><span style='text-decoration: underline;'>2</span><span>337    -</span><span style='color: #BB0000;'>413.</span><span> 
#&gt; </span><span style='color: #555555;'> 2</span><span> broom   2017-01-02  </span><span style='text-decoration: underline;'>1</span><span>481     </span><span style='text-decoration: underline;'>1</span><span>481  304.          </span><span style='text-decoration: underline;'>2</span><span>337   -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>160.</span><span> 
#&gt; </span><span style='color: #555555;'> 3</span><span> broom   2017-01-03  </span><span style='text-decoration: underline;'>1</span><span>851     </span><span style='text-decoration: underline;'>1</span><span>851  503.          </span><span style='text-decoration: underline;'>2</span><span>337    -</span><span style='color: #BB0000;'>989.</span><span> 
#&gt; </span><span style='color: #555555;'> 4</span><span> broom   2017-01-04  </span><span style='text-decoration: underline;'>1</span><span>947     </span><span style='text-decoration: underline;'>1</span><span>947  485.          </span><span style='text-decoration: underline;'>2</span><span>337    -</span><span style='color: #BB0000;'>875.</span><span> 
#&gt; </span><span style='color: #555555;'> 5</span><span> broom   2017-01-05  </span><span style='text-decoration: underline;'>1</span><span>927     </span><span style='text-decoration: underline;'>1</span><span>927  394.          </span><span style='text-decoration: underline;'>2</span><span>337    -</span><span style='color: #BB0000;'>804.</span><span> 
#&gt; </span><span style='color: #555555;'> 6</span><span> broom   2017-01-06  </span><span style='text-decoration: underline;'>1</span><span>948     </span><span style='text-decoration: underline;'>1</span><span>948   54.8         </span><span style='text-decoration: underline;'>2</span><span>337    -</span><span style='color: #BB0000;'>444.</span><span> 
#&gt; </span><span style='color: #555555;'> 7</span><span> broom   2017-01-07  </span><span style='text-decoration: underline;'>1</span><span>542     </span><span style='text-decoration: underline;'>1</span><span>542 -</span><span style='color: #BB0000;'>870.</span><span>          </span><span style='text-decoration: underline;'>2</span><span>337      74.7
#&gt; </span><span style='color: #555555;'> 8</span><span> broom   2017-01-08  </span><span style='text-decoration: underline;'>1</span><span>479     </span><span style='text-decoration: underline;'>1</span><span>479 -</span><span style='color: #BB0000;'>871.</span><span>          </span><span style='text-decoration: underline;'>2</span><span>337      13.1
#&gt; </span><span style='color: #555555;'> 9</span><span> broom   2017-01-09  </span><span style='text-decoration: underline;'>2</span><span>057     </span><span style='text-decoration: underline;'>2</span><span>057  304.          </span><span style='text-decoration: underline;'>2</span><span>337    -</span><span style='color: #BB0000;'>584.</span><span> 
#&gt; </span><span style='color: #555555;'>10</span><span> broom   2017-01-10  </span><span style='text-decoration: underline;'>2</span><span>278     </span><span style='text-decoration: underline;'>2</span><span>278  503.          </span><span style='text-decoration: underline;'>2</span><span>337    -</span><span style='color: #BB0000;'>562.</span><span> 
#&gt; </span><span style='color: #555555;'># … with 6,365 more rows</span><span></div><div class='input'>
</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Matt Dancho, Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


