<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Decompose a time series in preparation for anomaly detection — time_decompose • anomalize</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
<meta property="og:title" content="Decompose a time series in preparation for anomaly detection — time_decompose" />

<meta property="og:description" content="Decompose a time series in preparation for anomaly detection" />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Google analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76139189-1', 'auto');
  ga('send', 'pageview');

</script>



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">anomalize</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/anomalize_quick_start_guide.html">Anomalize Quick Start Guide</a>
    </li>
    <li>
      <a href="../articles/anomalize_methods.html">Anomalize Methods</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/business-science/anomalize">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Decompose a time series in preparation for anomaly detection</h1>
    <small>Source: <a href='https://github.com/business-science/anomalize/blob/master/R/time_decompose.R'><code>R/time_decompose.R</code></a></small>
    </div>

    
    <p>Decompose a time series in preparation for anomaly detection</p>
    

    <pre class="usage"><span class='fu'>time_decompose</span>(<span class='no'>data</span>, <span class='no'>target</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"stl"</span>, <span class='st'>"twitter"</span>),
  <span class='kw'>frequency</span> <span class='kw'>=</span> <span class='st'>"auto"</span>, <span class='kw'>trend</span> <span class='kw'>=</span> <span class='st'>"auto"</span>, <span class='no'>...</span>, <span class='kw'>merge</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>message</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A <code>tibble</code> or <code>tbl_time</code> object.</p></td>
    </tr>
    <tr>
      <th>target</th>
      <td><p>A column to apply the function to</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>The time series decomposition method. One of <code>"stl"</code> or <code>"twitter"</code>.
The STL method uses seasonal decomposition (see <code><a href='decompose_methods.html'>decompose_stl()</a></code>).
The Twitter method uses <code>trend</code> to remove the trend (see <code><a href='decompose_methods.html'>decompose_twitter()</a></code>).</p></td>
    </tr>
    <tr>
      <th>frequency</th>
      <td><p>Controls the seasonal adjustment (removal of seasonality).
Input can be either "auto", a time-based definition (e.g. "2 weeks"),
or a numeric number of observations per frequency (e.g. 10).
Refer to <code><a href='time_frequency.html'>time_frequency()</a></code>.</p></td>
    </tr>
    <tr>
      <th>trend</th>
      <td><p>Controls the trend component
For stl, the trend controls the sensitivity of the lowess smoother, which is used to remove the remainder.
For twitter, the trend controls the period width of the median, which are used to remove the trend and center the remainder.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional parameters passed to the underlying method functions.</p></td>
    </tr>
    <tr>
      <th>merge</th>
      <td><p>A boolean. <code>FALSE</code> by default. If <code>TRUE</code>, will append results to the original data.</p></td>
    </tr>
    <tr>
      <th>message</th>
      <td><p>A boolean. If <code>TRUE</code>, will output information related to <code>tbl_time</code> conversions, frequencies,
and trend / median spans (if applicable).</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns a <code>tbl_time</code> object.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>time_decompose()</code> function generates a time series decomposition on
<code>tbl_time</code> objects. The function is "tidy" in the sense that it works
on data frames. It is designed to work with time-based data, and as such
must have a column that contains date or datetime information. The function
also works with grouped data. The function implements several methods
of time series decomposition, each with benefits.</p>
<p><strong>STL</strong>:</p>
<p>The STL method (<code>method = "stl"</code>) implements time series decomposition using
the underlying <code><a href='decompose_methods.html'>decompose_stl()</a></code> function. If you are familiar with <code><a href='http://www.rdocumentation.org/packages/stats/topics/stl'>stats::stl()</a></code>,
the function is a "tidy" version that is designed to work with <code>tbl_time</code> objects.
The decomposition separates the "season" and "trend" components from
the "observed" values leaving the "remainder" for anomaly detection.
The user can control two parameters: <code>frequency</code> and <code>trend</code>.
The <code>frequency</code> parameter adjusts the "season" component that is removed
from the "observed" values. The <code>trend</code> parameter adjusts the
trend window (<code>t.window</code> parameter from <code>stl()</code>) that is used.
The user may supply both <code>frequency</code>
and <code>trend</code> as time-based durations (e.g. "6 weeks") or numeric values
(e.g. 180) or "auto", which predetermines the frequency and/or trend
based on the scale of the time series.</p>
<p><strong>Twitter</strong>:</p>
<p>The Twitter method (<code>method = "twitter"</code>) implements time series decomposition using
the methodology from the Twitter <a href='https://github.com/twitter/AnomalyDetection'>AnomalyDetection</a> package.
The decomposition separates the "seasonal" component and then removes
the median data, which is a different approach than the STL method for removing
the trend. This approach works very well for low-growth + high seasonality data.
STL may be a better approach when trend is a large factor.
The user can control two parameters: <code>frequency</code> and <code>trend</code>.
The <code>frequency</code> parameter adjusts the "season" component that is removed
from the "observed" values. The <code>trend</code> parameter adjusts the
period width of the median spans that are used. The user may supply both <code>frequency</code>
and <code>trend</code> as time-based durations (e.g. "6 weeks") or numeric values
(e.g. 180) or "auto", which predetermines the frequency and/or median spans
based on the scale of the time series.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <ol>
<li><p>CLEVELAND, R. B., CLEVELAND, W. S., MCRAE, J. E., AND TERPENNING, I.
STL: A Seasonal-Trend Decomposition Procedure Based on Loess. Journal of Official Statistics, Vol. 6, No. 1 (1990), pp. 3-73.</p></li>
<li><p><a href='https://www.usenix.org/system/files/conference/hotcloud14/hotcloud14-vallis.pdf'>Owen S. Vallis, Jordan Hochenbaum and Arun Kejariwal (2014).A Novel Technique for Long-Term Anomaly Detection in the Cloud. Twitter Inc.</a></p></li>
<li><p><a href='https://github.com/twitter/AnomalyDetection'>Owen S. Vallis, Jordan Hochenbaum and Arun Kejariwal (2014). AnomalyDetection: Anomaly Detection UsingSeasonal Hybrid Extreme Studentized Deviate Test. R package version 1.0.</a></p></li>
</ol>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p>Decomposition Methods (Powers <code>time_decompose</code>)</p><ul>
<li><p><code><a href='decompose_methods.html'>decompose_stl()</a></code></p></li>
<li><p><code><a href='decompose_methods.html'>decompose_twitter()</a></code></p></li>
</ul>
    <p>Time Series Anomaly Detection Functions (anomaly detection workflow):</p><ul>
<li><p><code><a href='anomalize.html'>anomalize()</a></code></p></li>
<li><p><code><a href='time_recompose.html'>time_recompose()</a></code></p></li>
</ul>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'>library</span>(<span class='no'>dplyr</span>)

<span class='fu'>data</span>(<span class='no'>tidyverse_cran_downloads</span>)

<span class='co'># Basic Usage</span>
<span class='no'>tidyverse_cran_downloads</span> <span class='kw'>%&gt;%</span>
    <span class='fu'>time_decompose</span>(<span class='no'>count</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"stl"</span>)</div><div class='output co'>#&gt; # A time tibble: 6,375 x 6
#&gt; # Index:  date
#&gt; # Groups: package [15]
#&gt;    package date       observed season trend remainder
#&gt;    &lt;chr&gt;   &lt;date&gt;        &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
#&gt;  1 tidyr   2017-01-01     873. -2761. 5053.    -1418.
#&gt;  2 tidyr   2017-01-02    1840.   901. 5047.    -4108.
#&gt;  3 tidyr   2017-01-03    2495.  1460. 5041.    -4006.
#&gt;  4 tidyr   2017-01-04    2906.  1430. 5035.    -3559.
#&gt;  5 tidyr   2017-01-05    2847.  1239. 5029.    -3421.
#&gt;  6 tidyr   2017-01-06    2756.   367. 5024.    -2635.
#&gt;  7 tidyr   2017-01-07    1439. -2635. 5018.     -944.
#&gt;  8 tidyr   2017-01-08    1556. -2761. 5012.     -695.
#&gt;  9 tidyr   2017-01-09    3678.   901. 5006.    -2229.
#&gt; 10 tidyr   2017-01-10    7086.  1460. 5000.      626.
#&gt; # ... with 6,365 more rows</div><div class='input'>
<span class='co'># twitter</span>
<span class='no'>tidyverse_cran_downloads</span> <span class='kw'>%&gt;%</span>
    <span class='fu'>time_decompose</span>(<span class='no'>count</span>,
                   <span class='kw'>method</span>       <span class='kw'>=</span> <span class='st'>"twitter"</span>,
                   <span class='kw'>frequency</span>    <span class='kw'>=</span> <span class='st'>"1 week"</span>,
                   <span class='kw'>trend</span>        <span class='kw'>=</span> <span class='st'>"2 months"</span>,
                   <span class='kw'>merge</span>        <span class='kw'>=</span> <span class='fl'>TRUE</span>,
                   <span class='kw'>message</span>      <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; # A time tibble: 6,375 x 7
#&gt; # Index:  date
#&gt; # Groups: package [15]
#&gt;    package date       count observed season median_spans remainder
#&gt;    &lt;chr&gt;   &lt;date&gt;     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;
#&gt;  1 tidyr   2017-01-01  873.     873. -2619.        5297.    -1805.
#&gt;  2 tidyr   2017-01-02 1840.    1840.   891.        5297.    -4348.
#&gt;  3 tidyr   2017-01-03 2495.    2495.  1409.        5297.    -4211.
#&gt;  4 tidyr   2017-01-04 2906.    2906.  1346.        5297.    -3737.
#&gt;  5 tidyr   2017-01-05 2847.    2847.  1199.        5297.    -3649.
#&gt;  6 tidyr   2017-01-06 2756.    2756.   247.        5297.    -2788.
#&gt;  7 tidyr   2017-01-07 1439.    1439. -2472.        5297.    -1386.
#&gt;  8 tidyr   2017-01-08 1556.    1556. -2619.        5297.    -1122.
#&gt;  9 tidyr   2017-01-09 3678.    3678.   891.        5297.    -2510.
#&gt; 10 tidyr   2017-01-10 7086.    7086.  1409.        5297.      380.
#&gt; # ... with 6,365 more rows</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Matt Dancho, Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

